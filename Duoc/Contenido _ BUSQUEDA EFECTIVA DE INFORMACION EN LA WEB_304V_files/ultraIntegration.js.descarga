(function(){"use strict";const R={dbUpdateCount:-1,defaultHelpArticleUrl:"",defaultHelpArticleName:"",supportCenterPortalId:"",isSupportCenterLoaded:!1,isExpertModeActive:!1,lmsMode:"originalCourseExperience",isSupportCenterPanelShowing:!1,request_resizeSupportCenter:"small",route:"",activeAnalyticsId:"",buildNumber:"",courseId:"-1",userLanguageId:"-1",proactiveLanguage:{LNG:{}},uefSettings:{UEF:{},PROACTIVE:{}},isDoNotShowAgainActive:"",baseUrl:"",isNotificationCloseIconClicked:-1,analyticsIdToHelpItemMap:{},availableAnalyticsIds:[],request_embeddedArticle:null,request_embeddedMessage:null,request_closeSupportCenter:!1,request_stepButtonClicked:null,stepToShow:null,transitionClickListener:null},x="Impact_Ultra_";function U(e){return`${x}${e}`}function ce(e,t){return sessionStorage.setItem(U(e),JSON.stringify(t))}function ue(e){const t=sessionStorage.getItem(U(e));return t?JSON.parse(t):R[e]}function de(){const t=["isSupportCenterPanelShowing","isNotificationCloseIconClicked","isSupportCenterLoaded","isExpertModeActive","activeAnalyticsId","availableAnalyticsIds","route","request_embeddedArticle","request_embeddedMessage","request_resizeSupportCenter","request_closeSupportCenter","stepToShow","transitionClickListener"].reduce((n,o)=>(n[o]=R[o],n),{});V(t)}function V(e){Object.entries(e).forEach(([t,n])=>{ce(t,n)})}const a={getValue:ue,setState:V,reset:de};var S=(e=>(e.POPUP="popup",e.SYSTRAY="systray",e.HINT="hint",e))(S||{}),h=(e=>(e.HelpRequest="uefIntegration.helpRequest",e.RouteChange="uefIntegration.routeChange",e.OnHover="uefIntegration.hover",e.OnClick="uefIntegration.click",e.CloseMessage="closeUefMessage",e.RecreateMessage="recreateUefMessage",e.WalkStepAction="walkStepAction",e.CloseWalk="closeWalk",e))(h||{});const u={uefIntegration:{requestHelp:()=>window.dispatchEvent(new CustomEvent(h.HelpRequest)),handleContentChanged:()=>window.dispatchEvent(new CustomEvent(h.RouteChange)),handleItemHover:()=>window.dispatchEvent(new CustomEvent(h.OnHover)),handleItemClick:()=>window.dispatchEvent(new CustomEvent(h.OnClick)),addPriorityHelpItem:e=>document.dispatchEvent(new CustomEvent("helpitemHandle",{detail:{helpitemGuid:e}})),closeMessage:(e,t)=>window.postMessage({type:h.CloseMessage,helpItemId:e,doNotShowAgain:t}),recreateMessage:e=>window.postMessage({type:h.RecreateMessage,helpItemId:e}),handleStepAction:e=>document.dispatchEvent(new CustomEvent(h.WalkStepAction,{detail:{action:e}})),closeWalk:e=>document.dispatchEvent(new CustomEvent(h.CloseWalk,{detail:{helpItemId:e}}))}},j=`ultraIntegrationConfigForImpact_${window.location.host}`;function pe(){try{const e=JSON.parse(sessionStorage[j]);if(e)return e}catch{console.error("Error while reading config")}}const fe=e=>sessionStorage.setItem(j,JSON.stringify(e)),d=()=>{const e=pe();if(!e)throw new Error("Ultra integration config was not initialized yet.");return e},ge=()=>sessionStorage.getItem("eesysoft_session_key")??"",he=e=>{sessionStorage.setItem("eesysoft_session_key",e)},E=()=>a.getValue("uefSettings"),$=()=>a.getValue("proactiveLanguage");async function me(){const e=await Ie();return Ce(e),new Promise(t=>{document.addEventListener("engineLoaded",()=>t())})}async function we(){try{const{lmsHost:e,userId:t,token:n}=d();return await(await fetch(`${e}/learn/api/public/v1/users/uuid:${t}`,{headers:{Authorization:`Bearer ${n}`}})).json()}catch(e){throw new Error("Unable to connect with bb API",e)}}async function ye(){try{const{lmsHost:e,userId:t,token:n}=d();return(await(await fetch(`${e}/learn/api/public/v1/users/uuid:${t}/courses`,{headers:{Authorization:`Bearer ${n}`}})).json()).results}catch(e){throw new Error("Unable to connect with bb API",e)}}async function Ie(){const[e,t]=await Promise.all([we(),ye()]),n=new Set([...e.institutionRoleIds,...t.map(({courseRoleId:dt})=>`CourseRole_${dt}`)]),o=Array.from(n),{userRoles:s,userName:i,userEmail:r,userLocale:c,userFullName:p,eesySignature:I}=d(),C=`${s}#COMMA#${o.join("#COMMA#")}`,b=document.referrer.substring(document.referrer.indexOf(":")+3),ct=b.substring(0,b.indexOf("/")),ut=[`username=${encodeURIComponent(i)}/auto/bb`,`mail=${encodeURIComponent(r)}`,`locale=${encodeURIComponent(c)}`,`fullname=${encodeURIComponent(p)}`,`roles=${encodeURIComponent(C)}`,`pk1=${e.id}`,"isUltra=true",`host=${ct}`,`signature=${I}`].join("&"),H=(await(await fetch("/UserLogin.jsp",{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded"},body:ut})).text()).trim();if(!H)throw new Error("Unable to get session key");return he(H),H}function Ce(e){const t=document.createElement("script"),{integrationHost:n}=d(),o=[`stmp=${Date.now()}`,"showquicklink=false","uef_mode=true","loadExpertTool=false",`k=${e}`].join("&");t.src=`${n}/loader.jsp?${o}`,t.async=!0,t.type="text/javascript",document.head.append(t)}const be=3,Se=1;function Me(...e){return e.join("/")}function ve(e){const t=Object.keys(e).reduce((n,o)=>{const s=e[o];return n[o]=typeof s=="string"?s:JSON.stringify(s),n},{});return new URLSearchParams(t).toString()}function m(e,t){const n=Me(...e);if(!t)return n;const o=ve(t);return[n,o].filter(Boolean).join("?")}const D="eesy-sc-panel";let k=!1;async function Ee(){const e=E();if(!e.UEF.SUPPORT_CENTER.ENABLED||!await ke())return;const t=d();l.registerSupportCenter(e.UEF.SUPPORT_CENTER.TITLE,`${t.integrationHost}/resources/images/${e.UEF.SUPPORT_CENTER.ICON}`)}async function ke(){const{customSupportTabVisibility:e}=d();try{if(e)return(await fetch(m(["/rest/public/support-center/show-support-button",ge()],{_dbcnt:a.getValue("dbUpdateCount")}))).json()}catch(t){console.error(t)}return!0}async function Te(e){try{if(!E().UEF.DEFAULT_HELP_ENABLED||!e)return;const t=e.substring(27),n=await fetch(m(["/rest/content/bbdrupal/title"],{path:t}));if(!n.ok){a.setState({defaultHelpArticleUrl:"",defaultHelpArticleName:""});return}const o=await n.text();a.setState({defaultHelpArticleUrl:e,defaultHelpArticleName:o})}catch{a.setState({defaultHelpArticleUrl:"",defaultHelpArticleName:""})}}function T(){if(a.getValue("isSupportCenterPanelShowing"))return;const e=a.getValue("request_resizeSupportCenter");a.setState({isSupportCenterPanelShowing:!0}),l.createPortalWithSupportCenter(e,E().UEF.SUPPORT_CENTER.TITLE)}function Ae(){a.getValue("isSupportCenterPanelShowing")&&(k=!0,q(),a.setState({isSupportCenterPanelShowing:!1}),T())}function q(){l.closeSupportCenter(a.getValue("supportCenterPortalId"))}const Oe="/rest/bbultra",Le=()=>({tag:"span",props:{style:{display:"flex",height:"100%",width:"100%",flexDirection:"column",alignItems:"stretch",justifyContent:"stretch"}},children:[{tag:"iframe",props:{style:{flex:"1 1 auto",position:"fixed",top:"0",left:"0",right:"0",bottom:"0",width:"100%",height:"100%"},src:`${d().integrationHost}${Oe}/iframe-panel?_=${a.getValue("dbUpdateCount")}`}}]});function Ne(){if(k){k=!1;return}a.setState({isSupportCenterPanelShowing:!1,supportCenterPortalId:""})}const l={authorize:()=>{const{token:e}=d();f().postMessage({type:"authorization:authorize",token:e})},injectTopLevelJs:()=>{const{integrationHost:e,styleChecksum:t,buildNumber:n}=d(),o=`styleChecksum=${t}&buildNumber=${n}`;f().postMessage({type:"injectjs:inject",url:`${e}/v2/dist/compiled/js/bbultra/top-window-script.js?${o}`})},registerSupportCenter:(e,t)=>{const n=d();f().postMessage({type:"help:register",id:n.appId,displayName:e,providerType:n.providerType,iconUrl:t})},registerHelpResponse:e=>{f().postMessage({type:"help:request:response",correlationId:e})},subscribe:()=>{f().postMessage({type:"event:subscribe",subscriptions:["click","route","hover","portal:new","portal:remove","lti:launch"]})},createPortalWithSupportCenter:(e,t)=>{f().postMessage({type:"portal:panel",correlationId:D,panelType:e,panelTitle:t,useCustomPadding:!0,attributes:{onClose:{callbackId:"eesy-sc-panel-close"}}})},closeSupportCenter:e=>{f().postMessage({type:"portal:panel:close",id:e})},renderSupportCenterInPortal:(e,t)=>{f().postMessage({type:"portal:render",portalId:e,contents:t})},renderModal:(e,t)=>f().promisified({type:"portal:modal",modalId:e,contents:t},n=>n.data.type==="portal:modal:response"&&n.data.modalId===e),closeModal:e=>f().promisified({type:"portal:modal:close",modalId:e},t=>t.data.type==="portal:modal:close:response"&&t.data.modalId===e),closeNotification:e=>f().promisified({type:"portal:notification:close",notificationId:e},t=>t.data.type==="portal:notification:close:response"&&t.data.notificationId===e),isModalOpen:async()=>{const e="test-portal-id";return(await f().promisified({type:"portal:modal",modalId:"test-portal-id",contents:{}},n=>n.data.type==="portal:modal:response"&&n.data.modalId===e)).error===Se},renderSystray:e=>f().promisified({type:"portal:notification",selector:{type:"notification:region:selector",value:"bottom:right"},contents:e},t=>t.data.type==="portal:notification:response"),renderHint:(e,t)=>f().promisified({type:"portal:notification",selector:{type:"notification:analytics:selector",value:e},contents:t},n=>n.data.type==="portal:notification:response"),checkVisibility:e=>f().promisified({type:"analytics:visible",analyticsIds:e},t=>t.data.type==="analytics:visible")};async function B(e,t,n,o){if(await l.isModalOpen())throw new Error("modal already open");const i=await l.renderSystray(xe(e,t,n));if(i.status!=="success")throw new Error(i.errorMessage??"");const{notificationId:r}=i;M(e,"systray",r,null,o)}async function _e(e,t,n,o,s){if(w(e))throw new Error("helItem notification already exists");if(await l.isModalOpen())throw new Error("modal already open");if(!o)throw new Error("analytic id is not found");const r=await l.renderHint(o,z(e,t,n));if(r.status!=="success")throw new Error(r.errorMessage??"");const{notificationId:c}=r;M(e,"hintOnHover",c,null,s),Pe()}let A=!1;function Pe(){A=!0,setTimeout(()=>{A=!1},2e3)}function He(){return A}async function F(e,t,n,o,s){if(w(e))throw new Error("helItem notification already exists");if(await l.isModalOpen())throw new Error("modal already open");if(!o||!a.getValue("availableAnalyticsIds").includes(o))return;const r=await l.renderHint(o,z(e,t,n));if(r.status!=="success")throw new Error(r.errorMessage??"");const{notificationId:c}=r;M(e,"proactiveHint",c,null,s)}async function Re(e){await O(e),u.uefIntegration.closeMessage(e,Z(e))}async function O(e){const t=w(e);if(!(t!=null&&t.notificationId))return;const n=await l.closeNotification(t.notificationId);Q(t.notificationId),n.status!=="success"&&n.error}function xe(e,t,n){const o=a.getValue("uefSettings"),{integrationHost:s}=d();return{tag:"Notification",props:{size:N(t,"small"),theme:o.PROACTIVE.STYLE.DARK?"dark":"light",hideBeak:!0},children:[{tag:"iframe",props:{style:{display:"flex",height:n+"px",width:"100%",flexDirection:"column",alignItems:"stretch",justifyContent:"stretch",border:"0",flex:"1 1 auto"},src:m([s,"rest/bbultra/helpitem",e],{_:a.getValue("buildNumber")})}}]}}function z(e,t,n){const o=a.getValue("uefSettings"),{integrationHost:s}=d();return{tag:"Notification",props:{size:N(t,"small"),theme:o.PROACTIVE.STYLE.DARK?"dark":"light",hideBeak:!1},children:[{tag:"iframe",props:{style:{display:"flex",height:n+"px",width:"100%",flexDirection:"column",alignItems:"stretch",justifyContent:"stretch",border:"0",flex:"1 1 auto"},src:m([s,"rest/bbultra/helpitem",e],{_:a.getValue("buildNumber")})}}]}}const L=e=>{const t=a.getValue("availableAnalyticsIds");return(Object.entries(a.getValue("analyticsIdToHelpItemMap")).find(([o,s])=>e&&s.includes(e)&&t.includes(o))??[])[0]};async function W(e,t,n,o,s){if(await l.isModalOpen())throw new Error("modal already open");const r=await l.renderModal(String(e),je(e,t,n,o,s));if(r.status!=="success")throw new Error(r.errorMessage??"");M(e,"popup",r.modalId,r.portalId,s)}async function K(e){const t=w(e);!(t!=null&&t.notificationId)||(await l.closeModal(t.notificationId)).status!=="success"||Q(t.notificationId)}function Ue(e){u.uefIntegration.closeMessage(e,Z(e))}function Ve(e){const t=a.getValue("stepToShow");return t?t.transitions.map(({type:n,caption:o},s)=>{const i=s===t.transitions.length-1;return{tag:"button",props:{onClick:{callbackId:v("modalStep",e,n),mode:"sync"},style:{marginBottom:"0"},className:i?"uef--button":"uef--button--secondary"},children:o}}):[]}function je(e,t,n,o,s){const{integrationHost:i}=d(),r=s?Ve(e):[{tag:"button",props:{onClick:{callbackId:v("modal",e,"close"),mode:"sync"},style:{marginBottom:"0"},className:"uef--button"},children:$().LNG.PROACTIVE.CLOSEBUTTON}];return{tag:"Modal",props:{width:N(t,"small")},children:[{tag:"ModalHeader",props:{title:o}},{tag:"ModalBody",children:[{tag:"iframe",props:{style:{display:"flex",height:n+"px",width:"100%",flexDirection:"column",alignItems:"stretch",justifyContent:"stretch",border:"0",flex:"1 1 auto"},src:m([i,"rest/bbultra/helpitem",e],{_:a.getValue("buildNumber")})}}]},{tag:"ModalFooter",children:r}]}}const g={},M=(e,t,n,o=null,s=!1)=>{g[e]||(g[e]={helpItemId:e,notificationId:n,portalId:o,type:t,isWalkStep:s})};let G;const J=e=>{G=g[e],delete g[e]},$e=()=>G,w=e=>g[e],Y=e=>{var n;const t=(n=Object.entries(g).find(([o,{notificationId:s}])=>s===e))==null?void 0:n[0];return t?Number(t):void 0},X=e=>{var n;const t=(n=Object.entries(g).find(([o,{portalId:s}])=>s===e))==null?void 0:n[0];return t?Number(t):void 0},De=e=>{const t=X(e);t&&J(t)},Q=e=>{const t=Y(e);t&&J(t)},qe=(e,t)=>{const n=Y(e);!n||!g[n]||(g[n].portalId=t)};function Z(e){return String(a.getValue("isDoNotShowAgainActive"))===String(e)}function N(e,t){if(Number.isNaN(e))return e==null?void 0:e.toLowerCase();{const n=Number(e);n>=270&&n<405?t="medium":n>=405&&(t="large")}return t}async function ee(e){var n;((n=w(e))==null?void 0:n.type)==="proactiveHint"&&await te(a.getValue("analyticsIdToHelpItemMap")),u.uefIntegration.recreateMessage(e)}async function Be(e){a.setState({analyticsIdToHelpItemMap:e}),await te(e)}async function te(e){const t=Object.keys(e),o=(await l.checkVisibility(t)).results.filter(({isElementVisible:s})=>s).map(({analyticsId:s})=>s);a.setState({availableAnalyticsIds:o})}const Fe=()=>Object.keys(g).length===0&&!a.getValue("isSupportCenterPanelShowing"),v=(e,t,n)=>["impact",e,t,n].join("||"),ze=e=>{const[t,n,o,s]=e.split("||");return{prefix:t,type:n,helpItemId:o,action:s}},We=e=>{var t;return(t=w(e))==null?void 0:t.isWalkStep},Ke=async()=>{const e=Object.values(g).map(t=>t.type==="popup"?K(t.helpItemId):O(t.helpItemId));await Promise.allSettled(e)};function _(e,t){u.uefIntegration.handleStepAction({helpItemId:e,type:t})}const ne="walk_close_confirmation";async function Ge(e){if(await l.isModalOpen())throw new Error("modal already open");const n=await l.renderModal(ne,Ye(e));if(n.status!=="success")throw new Error(n.errorMessage??"")}function Je(e){const t=a.getValue("transitionClickListener");if(!t)return;const{analyticsId:n,helpItemId:o}=t;if(n!==e)return;const s=$e();s&&s.helpItemId===o&&s.isWalkStep&&_(o,"next")}function Ye(e){const{integrationHost:t}=d(),{LNG:n}=$();return{tag:"Modal",props:{width:"medium"},children:[{tag:"ModalHeader",props:{title:n.PROACTIVE.WALKS.EXIT_MODAL.MODAL_TITLE}},{tag:"ModalBody",children:[{tag:"iframe",props:{style:{display:"flex",width:"100%",flexDirection:"column",alignItems:"stretch",justifyContent:"stretch",border:"0",flex:"1 1 auto"},src:m([t,"rest/bbultra/helpitem",e],{_:a.getValue("buildNumber"),isWalkExitConfirmation:!0})}}]},{tag:"ModalFooter",children:[{tag:"button",props:{onClick:{callbackId:v("walkCloseModal",e,"cancel"),mode:"sync"},style:{marginBottom:"0"},className:"uef--button--secondary"},children:n.PROACTIVE.WALKS.EXIT_MODAL.CANCEL_BUTTON},{tag:"button",props:{onClick:{callbackId:v("walkCloseModal",e,"confirm"),mode:"sync"},style:{marginBottom:"0"},className:"uef--button"},children:n.PROACTIVE.WALKS.EXIT_MODAL.CONFIRM_BUTTON}]}]}}const oe="blti_placement_id=";function se(e){return e.indexOf(oe)}async function Xe(e,t){Ze();const n=se(e);n===-1?await Qe(e,t):await ae(n,e,t)}async function Qe(e,t){var p;const n="content_id=",o=e.indexOf(n);if(o===-1)return;const s=e.substr(o+n.length).split("&")[0],{integrationHost:i,token:r}=d(),c=m([i,"learn/api/public/v1/courses",t,"contents",s]);try{const C=await(await fetch(c,{headers:{Authorization:`Bearer ${r}`}})).json(),b=((p=C==null?void 0:C.contentHandler)==null?void 0:p.url)??"";window.GlobalEesy=et(b),createCustomEvent("registerLtiLaunch",{detail:{launchType:"LTI_LAUNCH_CONTENTHANDLER_ULTRA",data:b,courseId:t}})}catch{console.error("Error connecting to learn course content api.")}}async function ae(e,t,n){const o=t.substr(e+oe.length).split("&")[0];createCustomEvent("registerLtiLaunch",{detail:{launchType:"LTI_LAUNCH_ULTRA",data:o,courseId:n}});const{integrationHost:s,token:i}=d(),r=m([s,"learn/api/public/v1/lti/placements",o]);try{const p=await(await fetch(r,{headers:{Authorization:`Bearer ${i}`}})).json();window.GlobalEesy.ActiveLTI={value:p==null?void 0:p.handle,type:"state",source:"page_load"}}catch{console.error("Error connecting to learn lti placement api.")}}function Ze(){delete window.GlobalEesy.ActiveLTI,delete window.GlobalEesy.ActiveLTIDomain,delete window.GlobalEesy.ActiveLTIDomainMain,delete window.GlobalEesy.ActiveLTIPath,delete window.GlobalEesy.ActiveLTIParams}function et(e){const t=e.substr(e.indexOf("://")+3),n=t.substr(0,t.indexOf("/")),o=n.split(".").slice(1),s=o.length>1?o.join("."):void 0,i=t.substr(t.indexOf("/"));let r,c;return i.indexOf("?")==-1?(r=i,c=void 0):(r=i.substr(0,i.indexOf("?")),c=i.substr(i.indexOf("?")+1)),{ActiveLTI:{},ActiveLTIDomain:{value:n,type:"state",source:"page_load"},ActiveLTIDomainMain:s?{value:s,type:"state",source:"page_load"}:{},ActiveLTIPath:{value:r,type:"state",source:"page_load"},ActiveLTIParams:c?{value:c,type:"state",source:"page_load"}:{}}}function re(e){window.parent.postMessage({messageHandler:"setUefRoute",route:e,GlobalEesy:window.GlobalEesy},"*")}function ie(e){var t;if((t=e==null?void 0:e.routeData)!=null&&t.courseId){const n=e.routeData.courseId,o=parseInt(n.substr(n.indexOf("_")+1,n.lastIndexOf("_")-1),10);le(o)}else le(void 0);u.uefIntegration.handleContentChanged(),[1e3,2500,4e3,5e3].forEach(n=>{setTimeout(()=>{u.uefIntegration.handleContentChanged()},n)})}function le(e){var n;window.eesy_course_id=e;const t=e?String(e):void 0;a.setState({courseId:t??"-1"}),(n=window.ImpactEngine)!=null&&n.isInitialized&&window.ImpactEngine.updateCourseId(t)}let y=!1;class tt{constructor(t){this.promisifiedCallbacks=[],this.onmessage=n=>ot(n,this.promisifiedCallbacks),this.onMessage=n=>{this.onmessage(n)},this.postMessage=n=>{this.messageChannel.postMessage(n)},this.promisified=(n,o)=>new Promise((s,i)=>{let r;const c=p=>{o(p)&&(clearTimeout(r),s(p.data),this.promisifiedCallbacks=this.promisifiedCallbacks.filter(I=>I!==c))};r=setTimeout(()=>{i(),this.promisifiedCallbacks=this.promisifiedCallbacks.filter(p=>p!==c)},3e3),this.promisifiedCallbacks.push(c),this.postMessage(n)}),this.messageChannel=t,this.messageChannel.onmessage=this.onMessage}}let P;const nt=e=>{P=new tt(e)},f=()=>{if(!P)throw new Error("Message channel was not initialized.");return P};async function ot(e,t){switch(t.forEach(n=>n(e)),e.data.type){case"authorization:authorize":l.injectTopLevelJs(),await me(),l.subscribe(),u.uefIntegration.handleContentChanged(),await Ee();return;case"event:event":await st(e.data);return;case"portal:callback":if(e.data.portalId===a.getValue("supportCenterPortalId")){Ne();return}const{prefix:n,type:o,helpItemId:s,action:i}=ze(e.data.callbackId);if(n!=="impact")return;if(o==="modalStep"){_(Number(s),i);return}if(o==="walkCloseModal"){i==="confirm"&&u.uefIntegration.closeWalk(Number(s)),await l.closeModal(ne);return}if(o==="modal"&&i==="close"){y=!0,(await l.closeModal(s)).status!=="success"&&await ee(Number(s));return}return;case"portal:panel:response":if(e.data.correlationId!==D)return;a.setState({supportCenterPortalId:e.data.portalId}),l.renderSupportCenterInPortal(e.data.portalId,Le());break;case"portal:modal:response":case"portal:notification:response":a.setState({request_embeddedMessage:null});break;case"portal:notification:status":if(e.data.status!=="queued")return;const{notificationId:r,portalId:c}=e.data;qe(r,c);break;case"portal:modal:close:response":{if(e.data.status!=="success")return;const p=Number(e.data.modalId);y&&Ue(p),y=!1;break}}}async function st(e){var t,n;switch(e.eventType){case"help:request":{u.uefIntegration.requestHelp(),a.setState({lmsMode:"ultra",isSupportCenterLoaded:!0}),await Te(e.helpUrl),l.registerHelpResponse(e.correlationId),T();break}case"route":{a.setState({route:e.routeName}),e.routeName.includes("peek.lti.launch-frame")?(await Xe(((t=e.routeData)==null?void 0:t.toolHref)??"",((n=e.routeData)==null?void 0:n.courseId)??""),re(e.routeName),ie(e)):(re(e.routeName),ie(e));break}case"portal:remove":const{portalId:o}=e,s=X(o);if(!s){u.uefIntegration.handleContentChanged();return}if(We(s)&&y){y=!1,_(s,"exit_walkthrough");return}at(s)&&await ee(s),De(o),u.uefIntegration.handleContentChanged();break;case"click":e.analyticsId==="integration.modal.header.close.button"&&(y=!0),Je(e.analyticsId),a.setState({activeAnalyticsId:e.analyticsId}),u.uefIntegration.handleItemClick(),u.uefIntegration.handleContentChanged(),setTimeout(u.uefIntegration.handleContentChanged,1500);break;case"hover":if(He()||e.analyticsId===a.getValue("activeAnalyticsId"))return;a.setState({activeAnalyticsId:e.analyticsId}),u.uefIntegration.handleItemHover();break;case"lti:launch":const i=e.launchData.toolHref,r=se(i);r!==-1&&await ae(r,i,window.eesy_course_id);break}}function at(e){var r;if(!e||e===a.getValue("isNotificationCloseIconClicked")||a.getValue("request_embeddedMessage")||a.getValue("request_embeddedArticle"))return!1;const o=(r=w(e))==null?void 0:r.type;return!(!(o!=="hintOnHover")||y&&o==="popup")}const rt=async e=>{var n,o;switch((n=e.key)==null?void 0:n.replace(x,"")){case"request_resizeSupportCenter":Ae();break;case"request_closeSupportCenter":if(!a.getValue("request_closeSupportCenter"))return;q(),a.setState({request_closeSupportCenter:!1});break;case"request_embeddedArticle":T();break;case"request_embeddedMessage":const s=(o=a.getValue("request_embeddedMessage"))==null?void 0:o.guid;if(!s)return;u.uefIntegration.addPriorityHelpItem(s);break;case"request_stepButtonClicked":const i=a.getValue("request_stepButtonClicked");if(!i)return;a.setState({request_stepButtonClicked:null}),u.uefIntegration.handleStepAction(i);break;case"isNotificationCloseIconClicked":{const r=JSON.parse(e.newValue??"");if(!r||r===-1)return;await Re(JSON.parse(r)),a.setState({isNotificationCloseIconClicked:-1});break}}},it=()=>{window.addEventListener("storage",rt)};window.ImpactUltraIntegration={start:async e=>{fe(e),a.reset(),it();const t=await lt();nt(t),l.authorize()},showPopup:async e=>{await W(e.id,e.width,e.height,e.title,!1)},showSystray:async e=>{await B(e.id,e.width,e.height,!1)},showHintOnHover:async e=>{const t=L(e.contextId);await _e(e.id,e.width,e.height,t,!1)},showProactiveHint:async e=>{const t=L(e.contextId);await F(e.id,e.width,e.height,t,!1)},setAnalyticsIdsMap:async e=>{await Be(e)},hideNotification:async e=>{await O(e)},hidePopup:async e=>{await K(e)},showWalkExitModal:async e=>{await Ge(e)},showWalkStep:async(e,t,n,o)=>{switch(a.setState({stepToShow:e,transitionClickListener:null}),t){case S.HINT:const s=L(n);await F(e.id,e.width,e.height,s,!0),o&&s&&a.setState({transitionClickListener:{helpItemId:e.id,analyticsId:s}});break;case S.SYSTRAY:await B(e.id,e.width,e.height,!0);break;case S.POPUP:await W(e.id,e.width,e.height,e.title,!0);break}},canShowMessage:()=>Fe(),hideAll:async()=>{await Ke()}};function lt(){const e=d();return new Promise((t,n)=>{const o=setTimeout(n,5e3),s=i=>{i.data.type==="integration:hello"&&(window.removeEventListener("message",s),clearTimeout(o),t(i.ports[0]))};window.addEventListener("message",s,!1),window.parent.postMessage({type:"integration:hello"},`${e.lmsHost}/*`)})}})();
